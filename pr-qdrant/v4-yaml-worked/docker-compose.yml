services:
  qdrant:
    image: qdrant/qdrant:latest
    restart: always
    container_name: qdrant
    ports:
      - "6333:6333"  # HTTP API
      - "6334:6334"  # gRPC API
    volumes:
      # Используем bind mount для удобного доступа к данным
      - ./qdrant_storage:/qdrant/storage
      # Монтируем наши файлы конфигурации
      - ./config.yaml:/qdrant/config/production.yaml
      - ./storage.yaml:/qdrant/config/storage.yaml
    # Указываем путь к главному конфигу
    command: ./qdrant --config-path /qdrant/config/production.yaml

    environment:
      - QDRANT__STORAGE__STORAGE_PATH=/qdrant/storage
      # Эти переменные переопределят/дополнят настройки из YAML-файлов
      - QDRANT__SERVICE__HTTP_PORT=6333
      - QDRANT__SERVICE__GRPC_PORT=6334
      - QDRANT__SERVICE__ENABLE_CORS=true
      # Путь к данным и снэпшотам задается здесь, это надежный способ
      - QDRANT__STORAGE__SNAPSHOTS_PATH=/qdrant/snapshots

      # - QDRANT__STORAGE__OPTIMIZERS__INDEXING_THRESHOLD_DUBL=2      # индекс сразу после 1 точки
      # - QDRANT__STORAGE__OPTIMIZER_CONFIG__INDEXING_THRESHOLD=5

      - QDRANT__TELEMETRY_DISABLED=true

volumes:
  qdrant_storage: